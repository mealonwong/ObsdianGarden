---
{"dg-publish":true,"permalink":"/my-sql/my-sql-log/"}
---



### Binlog

MySQL的二进制日志（Binlog）是MySQL数据库引擎提供的一种用于记录数据库更改操作的机制。Binlog包含了数据库中发生的所有插入、更新和删除操作，以及表结构的更改。它是数据库的事务日志，可用于多种用途，包括数据恢复、主从复制、数据库备份等。

以下是一些关键特点和用途：

1. **数据恢复**：Binlog是MySQL的一种基本的数据恢复机制。通过分析Binlog，可以还原特定时间点的数据库状态，从而用于修复数据错误或灾难性故障。
2. **主从复制**：Binlog用于主从复制（MySQL Replication）的实现。主库记录Binlog，并将其传输给从库，从库通过执行Binlog中的操作来与主库保持一致。这种机制用于分布式数据库、负载均衡和数据备份。
3. **数据备份**：通过定期备份Binlog，可以实现增量备份，而不必每次都备份整个数据库。这节省了备份时间和存储成本。
4. **审计和安全**：Binlog可用于跟踪和审计数据库中的所有更改操作，从而提高数据库的安全性。
5. **数据分析**：分析Binlog可用于数据库性能优化、数据分析和报告生成。例如，可以通过分析用户访问日志并将其记录到数据库中，然后分析Binlog来生成访问报告。
6. **数据同步**：通过分析Binlog，可以实现数据同步，将数据从一个MySQL数据库实例同步到另一个。

Binlog通常以二进制格式存储，因此需要特殊工具或MySQL提供的命令来解析和分析。不同版本的MySQL可能有不同的Binlog格式，包括ROW、STATEMENT和MIXED等，它们用于记录不同类型的操作。Binlog的管理和维护通常需要DBA或开发人员的专业知识。

总之，MySQL的Binlog是数据库管理中重要的组成部分，用于数据恢复、主从复制、备份和安全审计等多种用途。

记录格式：statement、row、mixed
- 指定statement，binlog记录的是sql语句原文，但这种格式可能存在一种问题，例如
   update T set update_time=now() where id=1该SQL语句，由于update_time-now()会获取系统当前时间，导致从库与原库的数据不一致。
- 指定row，此时记录的不再是SQL语句原文，还包含具体的数据操作，这种格式可以确保数据的一致性。但是该格式需要更大的容量来记录。
- 指定mixed，折中方案，MySQL会判断SQL语句是否会引起数据不一致，如果会则使用row格式，不会则使用statement格式。

### redolog

Redo日志（Redo Log）是数据库管理系统中的一种事务日志，用于记录在数据库上执行的事务操作。Redo日志是为了保证数据库的持久性和一致性而存在的，它在数据库的事务处理中扮演着关键的角色。

以下是Redo日志的一些关键特点和作用：

1. **数据恢复**：Redo日志记录了每个事务所做的更改，包括插入、更新和删除等。这使得在数据库发生故障时可以使用Redo日志来还原数据，从而实现数据的恢复。

2. **事务持久性**：在数据库中，数据的更改通常首先被写入Redo日志，然后再写入数据库文件。这种顺序确保了事务的持久性，即使在发生故障时，已提交的事务也不会丢失。

3. **事务回滚**：Redo日志还用于回滚未提交的事务。如果某个事务在执行过程中发生错误，数据库可以使用Redo日志来回滚该事务，撤销它的更改。

4. **主从复制**：Redo日志也是数据库主从复制（Replication）的重要组成部分。主数据库将Redo日志传递给从数据库，从数据库通过执行相同的Redo日志来与主数据库保持一致。

5. **性能优化**：Redo日志的使用可以提高数据库的性能。因为将更改操作首先记录到Redo日志，而不是立即写入数据库文件，这可以减少磁盘I/O操作，从而提高数据库的响应速度。

总之，Redo日志是数据库系统中的一项重要技术，用于保证事务的持久性、恢复数据、支持主从复制和提高性能。在数据库管理和维护中，Redo日志是一个关键的概念，DBA（数据库管理员）需要了解和管理Redo日志以确保数据库的可用性和稳定性。

### undolog

在数据库管理系统中，Undo日志（也称为Undo Log或Transaction Log）用于记录事务的操作，以便在需要时进行数据回滚或回滚事务。Undo日志是数据库的重要组成部分，主要用于以下几个方面：

1. 事务回滚：如果在事务执行期间发生错误，或者事务需要回滚到之前的状态，Undo日志允许数据库将事务的更改逆转。通过Undo日志，数据库可以还原事务执行前的数据状态。

2. 并发控制：数据库系统通常支持多个并发事务同时执行。Undo日志记录了每个事务所做的更改，以便在其他事务需要访问相同数据时进行冲突检测和解决。如果发生冲突，Undo日志可用于撤消一个事务的更改，以确保数据的一致性和隔离性。

3. 回滚段：Undo日志通常以回滚段（Rollback Segment）的形式存在，这是一种专门的数据结构用于存储Undo信息。回滚段是数据库的一部分，用于管理事务的Undo日志。

4. 长事务支持：长时间运行的事务可能会占用大量数据库资源，但同时也可能导致数据库崩溃或锁定。Undo日志用于支持长事务的回滚和回滚操作，以减小系统风险。

5. 一致性读取：数据库支持一致性读取，即当一个事务正在进行时，其他事务读取的数据应与事务开始之前的状态一致。Undo日志用于在执行一致性读取时提供旧数据的版本。

总之，Undo日志在数据库管理中的作用是确保数据的一致性、事务回滚、并发控制和支持长事务。通过记录事务的更改并提供撤消和回滚功能，数据库可以维护数据的完整性和可靠性。

另外，`MVCC` 的实现依赖于：**隐藏字段、Read View、undo log**。在内部实现中，`InnoDB` 通过数据行的 `DB_TRX_ID` 和 `Read View` 来判断数据的可见性，如不可见，则通过数据行的 `DB_ROLL_PTR` 找到 `undo log` 中的历史版本。每个事务读到的数据版本可能是不一样的，在同一个事务中，用户只能看到该事务创建 `Read View` 之前已经提交的修改和该事务本身做的修改


参考链接： https://javaguide.cn/database/mysql/mysql-logs.html